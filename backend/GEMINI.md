# Backend Project Details

This document outlines the key aspects of the backend application, built with FastAPI.

## Technologies Used

*   **Framework:** FastAPI
*   **Language:** Python 3.11+
*   **Dependency Management:** Poetry
*   **Database:** PostgreSQL (implied by `psycopg2-binary` and SQLAlchemy)
*   **ORM:** SQLAlchemy
*   **Migrations:** Alembic
*   **Authentication:** JWT (JSON Web Tokens) with `python-jose` and `passlib` (bcrypt)
*   **Configuration:** Pydantic Settings (`pydantic-settings`)
*   **Rate Limiting:** `slowapi`
*   **Logging:** Custom logging setup (`loguru`)
*   **Serialization/Validation:** Pydantic

## Project Structure

The backend follows a modular structure:

*   `app/api/`: Contains API routes, organized by version (`v1`).
    *   `v1/api.py`: Main API router for version 1.
    *   `routes/`: Individual route modules (e.g., `auth.py`, `task.py`, `user.py`).
*   `app/core/`: Core application functionalities.
    *   `config.py`: Application settings and environment variables.
    *   `security.py`: JWT token handling and password hashing.
    *   `logging.py`: Logging configuration.
*   `app/db/`: Database-related components.
    *   `session.py`: Database session management.
    *   `base.py`: Base for SQLAlchemy models.
    *   `models/`: SQLAlchemy ORM models (e.g., `task.py`, `user.py`).
*   `app/schemas/`: Pydantic schemas for request/response validation and serialization (e.g., `auth.py`, `task.py`, `user.py`).
*   `app/services/`: Business logic and service layer (e.g., `auth_service.py`, `task_service.py`, `user_service.py`).
*   `app/main.py`: Main application entry point, FastAPI app instance, middleware, and router inclusion.

## API Endpoints (Overview)

The API provides RESTful endpoints for managing tasks and users, with authentication.

*   **Authentication:**
    *   `POST /api/v1/auth/login`: User login.
    *   `POST /api/v1/auth/register`: User registration.
*   **Tasks:**
    *   `GET /api/v1/tasks`: Retrieve a list of tasks (with filtering, sorting, pagination planned).
    *   `POST /api/v1/tasks`: Create a new task.
    *   `PUT /api/v1/tasks/{id}`: Update an existing task.
    *   `DELETE /api/v1/tasks/{id}`: Delete a task.
    *   `GET /api/v1/tasks/statistics`: Get task statistics (planned).
    *   `POST /api/v1/tasks/{id}/comments`: Add a comment to a task (planned).
*   **Users:**
    *   `GET /api/v1/users/me`: Get current user's details.
    *   `GET /api/v1/users/{user_id}`: Get user by ID (admin only).
    *   `GET /api/v1/users/`: List all users (admin only).

## Deployment

The backend application is containerized using Docker.

### Dockerfile (`backend/Dockerfile`)

```dockerfile
# 1. Use the official Python base image
FROM python:3.11-slim

# 2. Set the working directory
WORKDIR /app

# 3. Instalar Poetry
RUN pip install poetry

# 4. Copy dependency files
COPY poetry.lock pyproject.toml /app/

# 5. Install project dependencies
RUN poetry config virtualenvs.create false && poetry install --no-dev --no-interaction --no-ansi

# 6. Copy the application code
COPY ./app /app/app

# 7. Expose the port the application uses
EXPOSE 8000

# 8. Command to run the application
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

## Setup and Running

1.  **Clone the repository.**
2.  **Navigate to the `backend` directory.**
3.  **Environment Variables:** Create a `.env` file based on `app/core/config.py` for database credentials, JWT secret, etc.
4.  **Database:** Ensure a PostgreSQL database is running and accessible.
5.  **Migrations:** Run Alembic migrations to set up the database schema.
6.  **Run with Docker:**
    ```bash
    docker build -t task-manager-backend .
    docker run -p 8000:8000 task-manager-backend
    ```
7.  **Run with Poetry (Development):**
    ```bash
    poetry install
    poetry run uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
    ```

## Testing

*   Unit tests with `pytest` (planned).
*   API endpoint tests (planned).

## Documentation

*   Swagger UI and ReDoc are automatically generated by FastAPI at `/docs` and `/redoc` respectively when the application is running.
